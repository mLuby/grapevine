<html>
  <head>
    <script src="http://kjur.github.io/jsrsasign/jsrsasign-latest-all-min.js"></script>
  </head>
  <body>
    <script>
      // ON SERVER
      // server generates RSA keys on init.
      var keys = KEYUTIL.generateKeypair("RSA", 1024);
      // server has a message object to send to peers.
      var message = {a: 'hello world', b:123, c:[1,]};
      // server signs message object with privateRSAKey.
      var signedJSONWebSignature = signJSON(message, keys.prvKeyObj);
      // server sends data to peer.
      var data = {message:message, signedJSONWebSignature:signedJSONWebSignature}; // TODO hackable
      console.log('data from server to peer',data);

      // ON PEER
      // peer has server publicRSAKey from when it first connected.
      var publicRSAKey = keys.pubKeyObj;
      // peer validates signedJSONWebSignature with publicRSAKey.
      var isValid = verifyJSON(data.signedJSONWebSignature, publicRSAKey);
      console.log('valid?',isValid,'message',data.message);
      
      function signJSON(jsonObject, privateRSAKey){
        var signedJSONWebSignature = KJUR.jws.JWS.sign('RS256', JSON.stringify({alg: 'RS256'}), jsonObject, privateRSAKey);
        console.log('RS256', JSON.stringify({alg: 'RS256'}), jsonObject, privateRSAKey,'=>',signedJSONWebSignature);
        return signedJSONWebSignature;     
      }

      function verifyJSON(signedJSONWebSignature, pubKey){
        // console.log('pubKey',pubKey,'signedJSONWebSignature',signedJSONWebSignature);
        var isValid = KJUR.jws.JWS.verify(signedJSONWebSignature, pubKey, ['RS256']);
        return !!isValid;
      };
    </script>
  </body>
</html>
