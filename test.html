<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <script src="http://cdn.peerjs.com/0.3/peer.min.js"></script>
  </head>
  <body>
    <h1 id='status'>Connection status</h1>
    <script>
      var thisPeer = new Peer(timeInSeconds(), {key: 'lwjd5qra8257b9'});
      console.log('my id is',thisPeer.id);

      var peers = [];

      // attempt connection every second
      setTimeout(function(){
        pushToPeers();
      }, 1000);

      function pushToPeers() {
        var testId = String(timeInSeconds() - 1);
        var connection = thisPeer.connect(testId);
        if(connection && testId !== thisPeer.id){
          peers.push(connection);
          console.log('added',testId,'to peers',typeof testId,typeof thisPeer.id);
        }
      }

      function send(conn, message) {
        conn.send(message);
      };

      thisPeer.on('connection', function(conn) {
        console.log('connection from', conn);
        conn.on('open', function() {
          console.log('connection open');

          // Receive messages
          conn.on('data', function(data) {
            console.log('Received', data, 'from', conn);
            document.getElementById('status').textContent = data;
          });
        });
      });

      function timeInSeconds() {
        return Math.round((new Date()).getTime()/10000);
      }
    </script>
  </body>
</html>
